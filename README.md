# Pacifica Data Cart
[![Build Status](https://travis-ci.org/EMSL-MSC/pacifica-cartd.svg?branch=master)](https://travis-ci.org/EMSL-MSC/pacifica-cartd)

Pacifica data cart for bundling and transfer of data sets.

This manages the bundling of data from the [archive interface]
(https://github.com/EMSL-MSC/pacifica-archiveinterface) and presents
APIs for users to use.

# Building and Installing

This code depends on the following libraries and python modules:

Docker/docker-compose

Peewee

Celery

MySQL-Python

psutil

pycurl

This is a standard python distutils build process.

```
python ./setup.py build
python ./setup.py install
```

# Running It

To bring up a test instance use docker-compose

```
docker-compose up
```

# API Examples

Every cart has a unique ID associated with it. For the examples
following we used a uuid generated by standard Linux utilities.

```
MY_CART_UUID=`uuidgen`
```

## Create a Cart

Post a file to create a new cart.

Contents of file (foo.json).

id =  the id being used on the Archive

path = internal structure of bundle for file placement 

```
{
  "fileids": [
    {"id":"foo.txt", "path":"1/2/3/foo.txt"},
    {"id":"bar.csv", "path":"1/2/3/bar.csv"},
    {"id":"baz.ini", "path":"2/3/4/baz.ini"}
  ]
}
```

Post the file to the following URL.
```
curl -X POST --upload-file /tmp/foo.json http://127.0.0.1:8081/$MY_CART_UUID
```

## Status a Cart

Head on the cart to find whether its created and ready for download.

```
curl -X HEAD http://127.0.0.1:8081/$MY_CART_UUID
```

Data returned should be json telling you status of cart.

If the cart is waiting to be processed and there is no current state.
```
{
  "status": "waiting"
}
```

If the cart is being processed and waiting for files to be staged locally.
```
{
  "status": "staging"
}
```

If the cart has the files locally and is currently creating the tarfile.
```
{
  "status": "bundling"
}
```

If the cart is finally ready for download.
```
{
  "status": "ready"
}
```

If the cart has an error (such as no space available to create the tarfile).
```
{
  "status": "error"
  "message": "No Space Available"
}
```

## Get the cart

To download the tarfile for the cart.

```
curl http://127.0.0.1:8081/$MY_CART_UUID
```
To save to file
```
curl -O http://127.0.0.1:8081/$MY_CART_UUID
```

## Delete a Cart

Delete a created cart.

```
curl -X DELETE http://127.0.0.1:8081/$MY_CART_UUID
```

Data returned should be json telling you status of cart deletion.