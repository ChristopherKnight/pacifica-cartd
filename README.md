# Pacifica Data Cart
[![Build Status](https://travis-ci.org/EMSL-MSC/pacifica-cartd.svg?branch=master)](https://travis-ci.org/EMSL-MSC/pacifica-cartd)

Pacifica data cart for bundling and transfer of data sets.

This manages the bundling of data from the [archive interface]
(https://github.com/EMSL-MSC/pacifica-archiveinterface) and presents
APIs for users to use.

# Building and Installing

This code depends on the following libraries and python modules:

Docker/docker-compose
Peewee
Celery
MySQL-Python
This is a standard python distutils build process.

```
python ./setup.py build
python ./setup.py install
```

# Running It

N/A

# API Examples

Every cart has a unique ID associated with it. For the examples
following we used a uuid generated by standard Linux utilities.

```
MY_CART_UUID=`uuidgen`
```

## Create a Cart

Post a file to create a new cart.

Contents of file (foo.json).
```
{
  "fileids": [
    1234,
    2345,
    3456,
    4567
  ]
}
```

Post the file to the following URL.
```
curl -X POST --upload-file /tmp/foo.json http://127.0.0.1:8080/$MY_CART_UUID
```

## Status a Cart

Head on the cart to find whether its created and ready for download.

```
curl -X HEAD http://127.0.0.1:8080/$MY_CART_UUID
```

Data returned should be json telling you status of cart.

If the cart is waiting to be processed and there is no current state.
```
{
  "status": "waiting"
}
```

If the cart is being processed and waiting for files to be staged locally.
```
{
  "status": "staging"
}
```

If the cart has the files locally and is currently creating the tarfile.
```
{
  "status": "bundling"
}
```

If the cart is finally ready for download.
```
{
  "status": "ready"
}
```

If the cart has no space available to create the tarfile.
```
{
  "status": "error"
  "message": "No Space Available"
}
```

## Get the cart

To download the tarfile for the cart.

```
curl http://127.0.0.1:8080/$MY_CART_UUID
```

